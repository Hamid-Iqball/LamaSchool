
generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}


model Admin {
  id String @id
  username String @unique
}

// In a one-to-many relationship, you follow this pattern:
// In the "one" model (e.g., Parent), you define a relationship array that refers to the many-side models (e.g., Student[]).
// In the "many" model (e.g., Student), you define a reference to the "one" model using a foreign key.


//In the first three model i am using the id as a string becasue we will have authentication but for other we won't have any authentications so we will use Int.
model Student{
    id  String @id
    username String @unique
    name String
    surname String
    email String? @unique
    phone String? @unique
    address String?
    img String?
    bloodType String
    sex UserSex
    createdAt DateTime @default(now)
    parentId String
    parent Parent @relation(fields:[parentId], references:[id])   
    classId Int
    class Class @relation(fields:[classId], reference:[id])
    gradeId Int
    grade Grade @relation(fields:[gradeId], reference :[id])
    attendence Attendence[]
    results Result[]


}

model Teacher{
   id String @id
    username String @unique
    name String
    surname String
    email String? @unique
    phone String? @unique
    address String
    img String?
    bloodType String
    sex UserSex
    createdAt DateTime @default(now)
    subjects Subject[] //mutiple subjects array
}


model Grade {
  id Int @id @default(autoincrement())
  level Int @unique
  
  students Student[]
  classes Class[]
}

model Parent{
   id String @id
    username String @unique
    name String
    surname String
    email String @unique
    phone String @unique
    address String?
    createdAt DateTime @default(now)
    students Student[]    //Parent and student has (one-to-many) relation. one parent can have many students.
    lessons Lesson[]
    classes Class[]

}

model Class{
  id Int @id @default(autoincrement())
  name String @unique
  capacity Int
  supervisorId String
  //Relations
  supervisor Teacher @relation(fields:[supervisorId], references:[id])
  gradeId Int
  grade Grade @relation(fields:[gradeId], reference :[id])
  lessons Lesson[]
  students Student[]
  events Event[]
  anouncements Announcement[]
}



model Subject {
  id Int @id @default(autoincrement())
  name String @unique
  teachers Teacher[]
  lessons Lesson[]
}


model Lesson{
  id Int @id @default(autoincrement())
  name String
  day Day
  startTime DateTime
  endTime DateTime

  subjectId Int
  subject Subject @relation(fields:[subjectId], references:[id])
  classId Int
  class Class @relation(fields:[classId], references:[id])
  teacherId String
  teacher Teacher @relation(fields:[teacherId], references:[id])
  exam Exam[]
  assignment Assignment[]
    attendence Attendence[]

  
}

model Exam{
  id Int @id @default(autoincrement())
  title String
  startDate DateTime
  endDate DateTime
  lessonId Int
  lessons Lesson @relation(fields:[lessonId], reference:[id])
    resultid Int
  result Result @relation(fields:[resultid], reference:[id])

}

 //result and assignment has a one to one relation
model Assignment {
  id Int @id @default(autoincrement())
  title String
  startTime DateTime
  dueTime DateTime
  lessonid Int
  lessons Lesson @relation(fields:[lessonId], reference:[id])

  resultid Int
  result Result @relation(fields:[resultid], reference:[id])

}

model Result {
  id Int @id @default(autoincrement())
  score Int

  assignmentId Int?
  assignment Assignment? @relation(fields:[assignmentId], reference:[id])

  examId Int?
  exam Exam? @relation(fields:[examId], reference:[id])

  studentId String
  student Student @relation(fields:[studentId], reference:[id])

}


model Attendence {
  id Int @id @default(autoincrement())
  date DateTime
  status Boolean
  studentId String
  student Student @relation(fields:[studentId], reference:[id])
  
  lessonId Int
  lesson Lesson @relation(fields:[lessonId], reference:[id])
}



model Event {
  id Int @id @default(autoincrement())
  title String
  description String
  startTime DateTime
  endTime DateTime

  classId Int?
  class Class @relation(fields:[classId], reference:[id])
}


model Announcement {
  id Int @id @default(autoincrement())
  title String
  description String
  date DateTime
  classId Int?
  class Class @relation(fields:[classId], reference:[id])
}


enum UserSex{
  MALE
  FEMALE
}


enum Day{
  MONDAYU
  TUESDAY
  WEDNESDAY
  THURSDAY
  FRIDAY
}